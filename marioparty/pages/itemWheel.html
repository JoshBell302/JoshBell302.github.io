<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/marioparty/styles/styles.css">
    <title>Item Wheel</title>
</head>

<body>
    <script src="/marioparty/scripts/icon.js"></script>
    <!-- Create the site header -->
    <div id="siteHeader"></div>
    <script src="/marioparty/header/loadHeader.js"></script>

    <h1>
        Item Wheel
    </h1>
    <div>
        <div class="rouletteSelector" id="rouletteContainer"></div>
        <button class="spinButton" id="startButton">Start Selector</button>
    </div>

    <script>
    const mushroomIcon = new Icon("Mushroom", "../images/items/mushroom.png", "#aa0055"); 
    const doubleDiceIcon = new Icon("Double Dice", "../images/items/double_dice.png", "#aa0055"); 
    const mirrorIcon = new Icon("Mirror", "../images/items/mirror.png", "#aa0055");
    
    const icons = [mushroomIcon, doubleDiceIcon, mirrorIcon];

    const grid = document.getElementById('rouletteContainer');
    const cells = [];

    // Create the cells
    for (let i = 0; i < icons.length; i++) {
        // Create the div to hold the item and item name
        const div = document.createElement('div');
        div.classList.add('cell');
        
        // Clone the image so multiple images can be used if needed
        const img = icons[i].image.cloneNode();

        // Create a label for the name of the item to also be viewed
        const label = document.createElement('span');
        label.textContent = icons[i].name;

        // Add elements to the div and then push the div to the rouletteSelector
        div.appendChild(img)
        div.appendChild(label);
        
        grid.appendChild(div);
        cells.push(div);
    }
    

    // Create SPIN button handler
    const startButton = document.getElementById("startButton")
    startButton.addEventListener("click", () => {
        // Disable the button untill the selector is finished
        startButton.disabled = true;
        startSelector();
	});
    
    function startSelector() {
        // Set up cell nodes to create the simulation of roulette
        let cellNode = {head: 0, tail: 0}
        let totalSteps = Math.floor(Math.random() * icons.length) + 15;
        let delay = 100;
        let step = 0;

        function lightUp() {
            // Clear previous cell and add new one
            cells[cellNode.tail].classList.remove("activeCell");
            cells[cellNode.head].classList.add('activeCell');

            // Check to see if we have reached final step
            if (step < totalSteps) {
                // Adjust cellNode
                step++;
                cellNode.tail = cellNode.head;
                cellNode.head = (cellNode.head + 1) % icons.length;

                // Slow down gradually
                delay += 10;
                setTimeout(lightUp, delay);
            } 
            else {
                setTimeout(() => {
                const result = cells[cellNode.head];
                alert(`Selected: ${result.textContent}`);
                startButton.disabled = false;
                }, 200); // wait briefly to let the user see the last light-up
            }
        }
    
        lightUp();

    }
</script>

</body>
</html>