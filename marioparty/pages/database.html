<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/marioparty/styles/styles.css">
    <title>Character Dashboard</title>
</head>

<body>
  <!-- Create the site header -->
  <div id="siteHeader"></div>
  <script src="/marioparty/header/loadHeader.js"></script>

  <h1>Database</h1>

  <script type="module">
    import { COIN_VALUES, addPlayer, deletePlayer, updateCoins, updateStars, 
      addItem, deleteItem, addSession, deleteSession, 
      getAllActivePlayers, getAllActiveItems, getActiveSession
    } from "/marioparty/scripts/api.js";
        
    // Button Listeners ---------------------
    // Add Player
    document.getElementById("addPlayerButton").addEventListener("click", () => {
      const name = document.getElementById("addPlayerNameInput").value;
      const character = document.getElementById("addPlayerCharacterInput").value;
      const session = document.getElementById("addPlayerSessionInput").value;
      addPlayer(session, name, character);
      showActivePlayers();
    });

    // Add Item
    document.getElementById("addItemButton").addEventListener("click", () => {
      const id = document.getElementById("addItemIdInput").value;
      const itemName = document.getElementById("addItemNameInput").value;
      const session = document.getElementById("addItemSessionInput").value;
      addItem(session, id, itemName);
      showActiveItems();
    });

    // Update Coins
    document.getElementById("updateCoinsButton").addEventListener("click", () => {
      const id = document.getElementById("updateCoinsIdInput").value;
      const number = document.getElementById("updateCoinsNumberInput").value;
      updateCoins(id, number);
    });

    // Update Stars
    document.getElementById("updateStarsButton").addEventListener("click", () => {
      const id = document.getElementById("updateStarsIdInput").value;
      const number = document.getElementById("updateStarsNumberInput").value;
      updateStars(id, number);
    });

    // Delete Player
    document.getElementById("deletePlayerButton").addEventListener("click", () => {
      const id = document.getElementById("deletePlayerInput").value;
      deletePlayer(id);
      showActivePlayers();
    });

    // Delete Item
    document.getElementById("deleteItemButton").addEventListener("click", () => {
      const id = document.getElementById("deleteItemInput").value;
      deleteItem(id);
      showActiveItems();
    });

    // Add Session
    document.getElementById("addSessionButton").addEventListener("click", () => {
      const id = document.getElementById("addSessionInput").value;
      addSession(id);
      showActivePlayers();
      showActiveItems();
      showActiveSession();
    });

    // Delete Session
    document.getElementById("deleteSessionButton").addEventListener("click", () => {
      deleteSession();
      showActivePlayers();
      showActiveItems();
      showActiveSession();
    });

    // Hidden Block
    document.getElementById("hiddenBlockButton").addEventListener("click", () => {
      const spaces = document.getElementById("hiddenBlockInput").value;
      const resultsElement = document.getElementById("hiddenBlockResults");
      const randomSpaceNumber = Math.floor(Math.random() * spaces)+1;
      resultsElement.innerHTML = `<div>Hidden Block is on Space number ${randomSpaceNumber}</div>`
    });

    // Star Space
    document.getElementById("starSpaceButton").addEventListener("click", () => {
      const spaces = document.getElementById("starSpaceInput").value;
      const resultsElement = document.getElementById("starSpaceResults");
      const randomSpaceNumber = Math.floor(Math.random() * spaces)+1;
      resultsElement.innerHTML = `<div>Star Space is over Blue Space number ${randomSpaceNumber}</div>`
    });


    // Coin Buttons -----------
    // Blue Space
    document.getElementById("blueSpace").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.blueSpace);
    });
    // Red Space
    document.getElementById("redSpace").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.redSpace);
    });
    // Solo Minigame 1st Place
    document.getElementById("soloMinigame1").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.soloMinigame1);
    });
    // Solo Minigame 2nd Place
    document.getElementById("soloMinigame2").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.soloMinigame2);
    });
    // Solo Minigame 3rd to 7th Place
    document.getElementById("soloMinigame3to7").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.soloMinigame3to7);
    });
    // Solo Minigame 8th Place +
    document.getElementById("soloMinigame8").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.soloMinigame8);
    });
    // Team Minigame Win
    document.getElementById("teamMinigameWin").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.teamMinigameWin);
    });
    // Team Minigame Loss
    document.getElementById("teamMinigameLoss").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.teamMinigameLoss);
    });
    // Buy Star
    document.getElementById("buyStar").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.buyStar);
    });
    // Buy Golden Pipe from the Shop
    document.getElementById("buyGoldenPipe").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.buyGoldenPipe);
    });
    // Buy Double Dice from the Shop
    document.getElementById("buyDoubleDice").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.buyDoubleDice);
    });
    // Buy Mirror from the Shop
    document.getElementById("buyMirror").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.buyMirror);
    });
    // Get Coins from Boo
    document.getElementById("booCoinGain").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.booCoinGain);
    });
    // Lose Coins from Boo
    document.getElementById("booCoinLoss").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.booCoinLoss);
    });
    // Buy a Star from Boo
    document.getElementById("booStarBuy").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.booStarBuy);
    });
    // Get Coins from the Hidden Block
    document.getElementById("hiddenBlockCoins").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateCoinsIdInput").value;
      updateCoinButton(id, COIN_VALUES.hiddenBlockCoins);
    });

    // Star Buttons -----------
    // Gain a Star
    document.getElementById("gainStar").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateStarsIdInput").value;
      updateStarButton(id, 1);
    });
    // Lose a Star
    document.getElementById("loseStar").addEventListener("click", () => {
      const id = document.getElementById("listOfUpdateStarsIdInput").value;
      updateStarButton(id, -1);
    });


    // --------------------------------------

    async function showActivePlayers() {
      const players = await getAllActivePlayers();
      console.log('Parsed players:', players);

      const resultsElement = document.getElementById("activePlayerResults");
    
      if (players && players.results) {
        resultsElement.innerHTML = players.results.map(player =>
          `<div>${player.name} as ${player.character_name} with ID ${player.id}</div>`
        ).join("");
      } 
      else {
        resultsElement.innerHTML = "<div>No players found</div>";
      }
    }
    showActivePlayers();

    async function showActiveItems() {
      const items = await getAllActiveItems();
      console.log('Parsed items:', items);

      const resultsElement = document.getElementById("activeItemsResults");
    
      if (items && items.result) {
        resultsElement.innerHTML = items.result.map(item => 
          `<div>${item.player_id} has a ${item.item_name} with ID ${item.id}</div>`
        ).join("");
      } 
      else {
        resultsElement.innerHTML = "<div>No items found</div>";
        }
      }
      showActiveItems();

    async function showActiveSession() {
      const session = await getActiveSession();
      console.log('Parse session:', session);

      const resultsElement = document.getElementById("activeSessionResults");
    
      if (session && session.result.length != 0) {
        resultsElement.innerHTML = `<div>Active Session ID of '${session.result[0].session_id}'</div>`
      } 
      else {
        resultsElement.innerHTML = "<div>No Active Session found</div>";
      }
    }
    showActiveSession();

    async function updateCoinButton(playerId, spaceCoins) {
      // Find player that matches ID given
      const activePlayers = await getAllActivePlayers();
      console.log('Parsed active players:', activePlayers);
      let matches = false;
      for (let i = 0; i < activePlayers.results.length; i++) {
        if (activePlayers.results[i].id == playerId) {
          updateCoins(playerId, activePlayers.results[i].coins + spaceCoins);
          console.log(`Player ID ${playerId} now has ${activePlayers.results[i].coins + spaceCoins} coins`);
          return;
        }
      }
      if (!matches) {
        console.log(`No matches found with ID ${playerId}`);
      }
    }

    async function updateStarButton(playerId, starAdjustment) {
      // Find player that matches ID given
      const activePlayers = await getAllActivePlayers();
      console.log('Parsed active players:', activePlayers);
      let matches = false;
      for (let i = 0; i < activePlayers.results.length; i++) {
        if (activePlayers.results[i].id == playerId) {
          updateStars(playerId, activePlayers.results[i].stars + starAdjustment);
          console.log(`Player ID ${playerId} now has ${activePlayers.results[i].stars + starAdjustment} star`);
          return;
        }
      }
      if (!matches) {
        console.log(`No matches found with ID ${playerId}`);
      }
    }
    </script>

    <div class="apiContainer">
        <!--Add Player-->
        <div class="apiCard">
            <h2>Add Player</h2>
            <div style="margin-top: 10px;">
                <label>Name:</label>
                <input type="text" id="addPlayerNameInput" placeholder="Enter Name">
            </div>
            <div style="margin-top: 5px;">
                <label>Character:</label>
                <input type="text" id="addPlayerCharacterInput" placeholder="Enter Character">
            </div>
            <div style="margin-top: 5px;">
                <label>Session ID:</label>
                <input type="text" id="addPlayerSessionInput" placeholder="Enter Session ID">
            </div>
            <button id="addPlayerButton" style="margin-top: 10px; margin-bottom: 10px;">Add Player</button>

            <div>
                <h2>Active Players</h2>
                <p id="activePlayerResults"></p>
            </div>
        </div>

        <!--Add Item-->
        <div class="apiCard">
            <h2>Add Item</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="addItemIdInput" placeholder="Enter ID">
            </div>
            <div style="margin-top: 5px;">
                <label>Item Name:</label>
                <input type="text" id="addItemNameInput" placeholder="Enter Item Name">
            </div>
            <div style="margin-top: 5px;">
                <label>Session ID:</label>
                <input type="text" id="addItemSessionInput" placeholder="Enter Session ID">
            </div>
            <button id="addItemButton" style="margin-top: 10px; margin-bottom: 10px;">Add Item</button>

            <div>
                <h2>Active Items</h2>
                <p id="activeItemsResults"></p>
            </div>
        </div>

        <!--Update Coins-->
        <div class="apiCard">
            <h2>Update Coins</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="updateCoinsIdInput" placeholder="Enter ID">
            </div>
            <div style="margin-top: 5px;">
                <label>Number:</label>
                <input type="text" id="updateCoinsNumberInput" placeholder="Enter Number of Coins">
            </div>
            <button id="updateCoinsButton" style="margin-top: 10px; margin-bottom: 10px;">Update Coins</button>
        </div>

        <!--Update Stars-->
        <div class="apiCard">
            <h2>Update Stars</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="updateStarsIdInput" placeholder="Enter ID">
            </div>
            <div style="margin-top: 5px;">
                <label>Number:</label>
                <input type="text" id="updateStarsNumberInput" placeholder="Enter Number of Stars">
            </div>
            <button id="updateStarsButton" style="margin-top: 10px; margin-bottom: 10px;">Update Stars</button>
        </div>

        <!--Delete Player-->
        <div class="apiCard">
            <h2>Delete Player</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="deletePlayerInput" placeholder="Enter ID">
            </div>
            <button id="deletePlayerButton" style="margin-top: 10px; margin-bottom: 10px;">Delete Player</button>
        </div>

        <!--Delete Item-->
        <div class="apiCard">
            <h2>Delete Item</h2>
            <div style="margin-top: 10px;">
                <label>Item ID:</label>
                <input type="text" id="deleteItemInput" placeholder="Enter ID">
            </div>
            <button id="deleteItemButton" style="margin-top: 10px; margin-bottom: 10px;">Delete Item</button>
        </div>

        <!--Add Session-->
        <div class="apiCard">
            <h2>Add Session</h2>
            <div style="margin-top: 10px;">
                <label>Session ID:</label>
                <input type="text" id="addSessionInput" placeholder="Enter ID">
            </div>
            <button id="addSessionButton" style="margin-top: 10px; margin-bottom: 10px;">Add Session</button>
            
            <div>
                <h2>Active Session</h2>
                <p id="activeSessionResults"></p>
            </div>
        </div>

        <!--Delete Session-->
        <div class="apiCard">
            <h2>Delete Session</h2>
            <button id="deleteSessionButton" style="margin-top: 10px; margin-bottom: 10px;">Delete Session</button>
        </div>
    </div>

    <!-- Easy Coin and Star Updates -->
   <div class="apiContainer" style="margin-top: 20px">
    <!--Coin Updates-->
    <div class="apiCard">
      <h2>List of Coin Updates</h2>
      <div style="margin-top: 10px;">
        <label>Player ID:</label>
        <input type="text" id="listOfUpdateCoinsIdInput" placeholder="Player ID">
      </div>
        <button id="blueSpace" style="margin-top: 10px; margin-bottom: 10px;">Blue Space</button>
        <button id="redSpace" style="margin-top: 10px; margin-bottom: 10px;">Red Space</button>
        <button id="soloMinigame1" style="margin-top: 10px; margin-bottom: 10px;">Solo Minigame 1st</button>
        <button id="soloMinigame2" style="margin-top: 10px; margin-bottom: 10px;">Solo Minigame 2nd</button>
        <button id="soloMinigame3to7" style="margin-top: 10px; margin-bottom: 10px;">Solo Minigame 3rd - 7th</button>
        <button id="soloMinigame8" style="margin-top: 10px; margin-bottom: 10px;">Solo Minigame 8th+</button>
        <button id="teamMinigameWin" style="margin-top: 10px; margin-bottom: 10px;">Team Minigame Win</button>
        <button id="teamMinigameLoss" style="margin-top: 10px; margin-bottom: 10px;">Team Minigame Loss</button>
        <button id="buyStar" style="margin-top: 10px; margin-bottom: 10px;">Buy Star</button>
        <button id="buyGoldenPipe" style="margin-top: 10px; margin-bottom: 10px;">Buy Golden Pipe</button>
        <button id="buyDoubleDice" style="margin-top: 10px; margin-bottom: 10px;">Buy Double Dice</button>
        <button id="buyMirror" style="margin-top: 10px; margin-bottom: 10px;">Buy Mirror</button>
        <button id="booCoinGain" style="margin-top: 10px; margin-bottom: 10px;">Boo Coin Gain</button>
        <button id="booCoinLoss" style="margin-top: 10px; margin-bottom: 10px;">Boo Coin Loss</button>
        <button id="booStarBuy" style="margin-top: 10px; margin-bottom: 10px;">Boo Star Buy</button>
        <button id="hiddenBlockCoins" style="margin-top: 10px; margin-bottom: 10px;">Hidden Block</button>
    </div>
    <!--Star Updates-->
    <div class="apiCard">
      <h2>List of Star Updates</h2>
      <div style="margin-top: 10px;">
        <label>Player ID:</label>
        <input type="text" id="listOfUpdateStarsIdInput" placeholder="Player ID">
      </div>
        <button id="gainStar" style="margin-top: 10px; margin-bottom: 10px;">Gain a Star</button>
        <button id="loseStar" style="margin-top: 10px; margin-bottom: 10px;">Lose a Star</button>
    </div>
    <!--Red Space-->
    <!--Hidden Block-->
    <!--Pay for Star-->
    <!--Pay for Golden Pipe-->
    <!--Pay for Double Dice-->
    <!--Pay for Mirror-->
    <!--Solo Minigame 1st-->
    <!--Solo Minigame 2nd-->
    <!--Solo Minigame 3rd to 7th-->
    <!--Solo Minigame 8th-->
    <!--Team Minigame Win-->
    <!--Team Minigame Loss-->
    <!--Boo Gain-->
    <!--Boo Loss-->


  <!-- For In-Game Secrets -->
   <div class="apiContainer" style="margin-top: 20px">
    <!--Hidden Block-->
    <div class="apiCard">
      <h2>Hidden Block</h2>
      <div style="margin-top: 10px;">
        <label>Number of Total Spaces:</label>
        <input type="text" id="hiddenBlockInput" placeholder="Number of Total Spaces">
      </div>
        <button id="hiddenBlockButton" style="margin-top: 10px; margin-bottom: 10px;">Find Hidden Block Space</button>
            
      <div>
        <h2>Current Location of Hidden Block</h2>
        <p id="hiddenBlockResults"></p>
      </div>
    </div>

    <!--Star Space-->
    <div class="apiCard">
      <h2>Star Space</h2>
      <div style="margin-top: 10px;">
        <label>Number of Blue Spaces:</label>
        <input type="text" id="starSpaceInput" placeholder="Number of Blue Spaces">
      </div>
        <button id="starSpaceButton" style="margin-top: 10px; margin-bottom: 10px;">Find Star Space</button>
            
      <div>
        <h2>Location of Star Space</h2>
        <p id="starSpaceResults"></p>
      </div>
    </div>
   </div>

</body>

</html>