<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/marioparty/styles/styles.css">
    <title>Character Dashboard</title>
</head>

<body>
  <!-- Create the site header -->
  <div id="siteHeader"></div>
  <script src="/marioparty/header/loadHeader.js"></script>

  <h1>Database</h1>

  <script type="module">
    import { addPlayer, deletePlayer, updateCoins, updateStars, 
      addItem, deleteItem, addSession, deleteSession, 
      getAllActivePlayers, getAllActiveItems, getActiveSession
    } from "/marioparty/scripts/api.js";
        
    // Button Listeners ---------------------
    // Add Player
    document.getElementById("addPlayerButton").addEventListener("click", () => {
      const name = document.getElementById("addPlayerNameInput").value;
      const character = document.getElementById("addPlayerCharacterInput").value;
      const session = document.getElementById("addPlayerSessionInput").value;
      addPlayer(session, name, character);
      showActivePlayers();
    });

    // Add Item
    document.getElementById("addItemButton").addEventListener("click", () => {
      const id = document.getElementById("addItemIdInput").value;
      const itemName = document.getElementById("addItemNameInput").value;
      const session = document.getElementById("addItemSessionInput").value;
      addItem(session, id, itemName);
      showActiveItems();
    });

    // Update Coins
    document.getElementById("updateCoinsButton").addEventListener("click", () => {
      const id = document.getElementById("updateCoinsIdInput").value;
      const number = document.getElementById("updateCoinsNumberInput").value;
      updateCoins(id, number);
    });

    // Update Stars
    document.getElementById("updateStarsButton").addEventListener("click", () => {
      const id = document.getElementById("updateStarsIdInput").value;
      const number = document.getElementById("updateStarsNumberInput").value;
      updateStars(id, number);
    });

    // Delete Player
    document.getElementById("deletePlayerButton").addEventListener("click", () => {
      const id = document.getElementById("deletePlayerInput").value;
      deletePlayer(id);
      showActivePlayers();
    });

    // Delete Item
    document.getElementById("deleteItemButton").addEventListener("click", () => {
      const id = document.getElementById("deleteItemInput").value;
      deleteItem(id);
      showActiveItems();
    });

    // Add Session
    document.getElementById("addSessionButton").addEventListener("click", () => {
      const id = document.getElementById("addSessionInput").value;
      addSession(id);
      showActivePlayers();
      showActiveItems();
      showActiveSession();
    });

    // Delete Session
    document.getElementById("deleteSessionButton").addEventListener("click", () => {
      deleteSession();
      showActivePlayers();
      showActiveItems();
      showActiveSession();
    });

    // Hidden Block
    document.getElementById("hiddenBlockButton").addEventListener("click", () => {
      const spaces = document.getElementById("hiddenBlockInput").value;
      const resultsElement = document.getElementById("hiddenBlockResults");
      const randomSpaceNumber = Math.floor(Math.random() * spaces)+1;
      resultsElement.innerHTML = `<div>Hidden Block is on Space number ${randomSpaceNumber}</div>`
    });

    // Star Space
    document.getElementById("starSpaceButton").addEventListener("click", () => {
      const spaces = document.getElementById("starSpaceInput").value;
      const resultsElement = document.getElementById("starSpaceResults");
      const randomSpaceNumber = Math.floor(Math.random() * spaces)+1;
      resultsElement.innerHTML = `<div>Star Space is over Blue Space number ${randomSpaceNumber}</div>`
    });
    // --------------------------------------

    async function showActivePlayers() {
      const players = await getAllActivePlayers();
      console.log('Parsed players:', players);

      const resultsElement = document.getElementById("activePlayerResults");
    
      if (players && players.results) {
        resultsElement.innerHTML = players.results.map(player =>
          `<div>${player.name} as ${player.character_name} with ID ${player.id}</div>`
        ).join("");
      } 
      else {
        resultsElement.innerHTML = "<div>No players found</div>";
      }
    }
    showActivePlayers();

    async function showActiveItems() {
      const items = await getAllActiveItems();
      console.log('Parsed items:', items);

      const resultsElement = document.getElementById("activeItemsResults");
    
      if (items && items.result) {
        resultsElement.innerHTML = items.result.map(item => 
          `<div>${item.player_id} has a ${item.item_name} with ID ${item.id}</div>`
        ).join("");
      } 
      else {
        resultsElement.innerHTML = "<div>No items found</div>";
        }
      }
      showActiveItems();

    async function showActiveSession() {
      const session = await getActiveSession();
      console.log('Parse session:', session);

      const resultsElement = document.getElementById("activeSessionResults");
    
      if (session && session.result.length != 0) {
        resultsElement.innerHTML = `<div>Active Session ID of '${session.result[0].session_id}'</div>`
      } 
      else {
        resultsElement.innerHTML = "<div>No Active Session found</div>";
      }
    }
    showActiveSession();
    </script>

    <div class="apiContainer">
        <!--Add Player-->
        <div class="apiCard">
            <h2>Add Player</h2>
            <div style="margin-top: 10px;">
                <label>Name:</label>
                <input type="text" id="addPlayerNameInput" placeholder="Enter Name">
            </div>
            <div style="margin-top: 5px;">
                <label>Character:</label>
                <input type="text" id="addPlayerCharacterInput" placeholder="Enter Character">
            </div>
            <div style="margin-top: 5px;">
                <label>Session ID:</label>
                <input type="text" id="addPlayerSessionInput" placeholder="Enter Session ID">
            </div>
            <button id="addPlayerButton" style="margin-top: 10px; margin-bottom: 10px;">Add Player</button>

            <div>
                <h2>Active Players</h2>
                <p id="activePlayerResults"></p>
            </div>
        </div>

        <!--Add Item-->
        <div class="apiCard">
            <h2>Add Item</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="addItemIdInput" placeholder="Enter ID">
            </div>
            <div style="margin-top: 5px;">
                <label>Item Name:</label>
                <input type="text" id="addItemNameInput" placeholder="Enter Item Name">
            </div>
            <div style="margin-top: 5px;">
                <label>Session ID:</label>
                <input type="text" id="addItemSessionInput" placeholder="Enter Session ID">
            </div>
            <button id="addItemButton" style="margin-top: 10px; margin-bottom: 10px;">Add Item</button>

            <div>
                <h2>Active Items</h2>
                <p id="activeItemsResults"></p>
            </div>
        </div>

        <!--Update Coins-->
        <div class="apiCard">
            <h2>Update Coins</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="updateCoinsIdInput" placeholder="Enter ID">
            </div>
            <div style="margin-top: 5px;">
                <label>Number:</label>
                <input type="text" id="updateCoinsNumberInput" placeholder="Enter Number of Coins">
            </div>
            <button id="updateCoinsButton" style="margin-top: 10px; margin-bottom: 10px;">Update Coins</button>
        </div>

        <!--Update Stars-->
        <div class="apiCard">
            <h2>Update Stars</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="updateStarsIdInput" placeholder="Enter ID">
            </div>
            <div style="margin-top: 5px;">
                <label>Number:</label>
                <input type="text" id="updateStarsNumberInput" placeholder="Enter Number of Stars">
            </div>
            <button id="updateStarsButton" style="margin-top: 10px; margin-bottom: 10px;">Update Stars</button>
        </div>

        <!--Delete Player-->
        <div class="apiCard">
            <h2>Delete Player</h2>
            <div style="margin-top: 10px;">
                <label>Player ID:</label>
                <input type="text" id="deletePlayerInput" placeholder="Enter ID">
            </div>
            <button id="deletePlayerButton" style="margin-top: 10px; margin-bottom: 10px;">Delete Player</button>
        </div>

        <!--Delete Item-->
        <div class="apiCard">
            <h2>Delete Item</h2>
            <div style="margin-top: 10px;">
                <label>Item ID:</label>
                <input type="text" id="deleteItemInput" placeholder="Enter ID">
            </div>
            <button id="deleteItemButton" style="margin-top: 10px; margin-bottom: 10px;">Delete Item</button>
        </div>

        <!--Add Session-->
        <div class="apiCard">
            <h2>Add Session</h2>
            <div style="margin-top: 10px;">
                <label>Session ID:</label>
                <input type="text" id="addSessionInput" placeholder="Enter ID">
            </div>
            <button id="addSessionButton" style="margin-top: 10px; margin-bottom: 10px;">Add Session</button>
            
            <div>
                <h2>Active Session</h2>
                <p id="activeSessionResults"></p>
            </div>
        </div>

        <!--Delete Session-->
        <div class="apiCard">
            <h2>Delete Session</h2>
            <button id="deleteSessionButton" style="margin-top: 10px; margin-bottom: 10px;">Delete Session</button>
        </div>
    </div>

    <!-- For In-Game Secrets -->
   <div class="apiContainer" style="margin-top: 20px">
    <!--Hidden Block-->
    <div class="apiCard">
      <h2>Hidden Block</h2>
      <div style="margin-top: 10px;">
        <label>Number of Total Spaces:</label>
        <input type="text" id="hiddenBlockInput" placeholder="Number of Total Spaces">
      </div>
        <button id="hiddenBlockButton" style="margin-top: 10px; margin-bottom: 10px;">Find Hidden Block Space</button>
            
      <div>
        <h2>Current Location of Hidden Block</h2>
        <p id="hiddenBlockResults"></p>
      </div>
    </div>

    <!--Star Space-->
    <div class="apiCard">
      <h2>Star Space</h2>
      <div style="margin-top: 10px;">
        <label>Number of Blue Spaces:</label>
        <input type="text" id="starSpaceInput" placeholder="Number of Blue Spaces">
      </div>
        <button id="starSpaceButton" style="margin-top: 10px; margin-bottom: 10px;">Find Star Space</button>
            
      <div>
        <h2>Location of Star Space</h2>
        <p id="starSpaceResults"></p>
      </div>
    </div>
   </div>

</body>

</html>